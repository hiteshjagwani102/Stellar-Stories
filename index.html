<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stellar Stories</title>

<!-- P5.js for the game -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600;700&display=swap');

:root{
  --light-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  --dark-bg: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
  --light-text:#2c3e50;
  --dark-text:#ecf0f1;
  --accent-light:#e74c3c;
  --accent-dark:#3498db;
  --card-light: rgba(255,255,255,0.95);
  --card-dark: rgba(20,25,45,0.95);
  --glow-color: #00d4ff;
  --secondary-glow: #ff6b6b;
}

* { box-sizing: border-box; }

body{
  margin:0;
  font-family:'Exo 2', sans-serif;
  background:var(--dark-bg);
  color:var(--dark-text);
  transition:all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  overflow-x:hidden;
  position:relative;
  line-height:1.6;
}

body.light{ 
  background:var(--light-bg); 
  color:var(--light-text); 
}

/* FLOATING PARTICLES */
.particles {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

.particle {
  position: absolute;
  background: radial-gradient(circle, var(--glow-color), transparent);
  border-radius: 50%;
  animation: float 15s infinite ease-in-out;
  opacity: 0.6;
}

@keyframes float {
  0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
  10% { opacity: 1; }
  90% { opacity: 1; }
  100% { transform: translateY(-10vh) rotate(360deg); opacity: 0; }
}

/* ENHANCED STARS/CLOUDS */
.stars{ 
  display:block; 
  position:fixed; 
  width:100%; 
  height:100%; 
  background:transparent; 
  pointer-events:none; 
  z-index:0; 
  opacity: 0.7;
}
body.light .stars{ display:none; }

.stars::before{
  content:''; 
  position:absolute; 
  width:200%; 
  height:200%;
  background-image: 
    radial-gradient(2px 2px at 20px 30px, #eee, transparent),
    radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
    radial-gradient(1px 1px at 90px 40px, #fff, transparent),
    radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
    radial-gradient(2px 2px at 160px 30px, #ddd, transparent);
  background-repeat: repeat;
  background-size: 200px 100px;
  animation:moveStars 120s linear infinite, twinkle 3s ease-in-out infinite alternate;
}

@keyframes moveStars{ 
  from{transform:translateY(0)} 
  to{transform:translateY(-50%)} 
}

@keyframes twinkle {
  0% { opacity: 0.7; }
  100% { opacity: 1; }
}

.clouds{ 
  display:none; 
  position:fixed; 
  width:100%; 
  height:100%; 
  pointer-events:none; 
  z-index:0;
  background: 
    radial-gradient(ellipse at center, rgba(255,255,255,0.1) 0%, transparent 50%),
    radial-gradient(ellipse at 20% 50%, rgba(255,255,255,0.05) 0%, transparent 50%),
    radial-gradient(ellipse at 80% 50%, rgba(255,255,255,0.08) 0%, transparent 50%);
  animation:moveClouds 180s linear infinite;
}

body.light .clouds{ display:block; }

@keyframes moveClouds{ 
  from{background-position: 0 0, -200px 0, 400px 0} 
  to{background-position: 1000px 0, 800px 0, 1400px 0} 
}

/* HEADER WITH GLASSMORPHISM */
header{ 
  text-align:center; 
  padding:60px 20px; 
  position:relative; 
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(10px);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  margin-bottom: 0;
  z-index: 10;
}

body.light header {
  background: rgba(255,255,255,0.25);
  backdrop-filter: blur(15px);
  border-bottom: 1px solid rgba(255,255,255,0.3);
}

header h1{ 
  margin:0; 
  font-family: 'Orbitron', monospace;
  font-size: clamp(2.5rem, 5vw, 4rem);
  font-weight: 900;
  background: linear-gradient(45deg, var(--glow-color), var(--secondary-glow));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  animation: glow-pulse 3s ease-in-out infinite alternate;
  text-shadow: 0 0 30px rgba(0,212,255,0.5);
  margin-bottom: 20px;
}

@keyframes glow-pulse {
  0% { 
    filter: brightness(1) drop-shadow(0 0 10px var(--glow-color)); 
  }
  100% { 
    filter: brightness(1.2) drop-shadow(0 0 20px var(--glow-color)); 
  }
}

header p{ 
  margin:10px auto; 
  font-size: 1.2rem;
  max-width: 600px;
  opacity: 0.9;
  animation: fadeInUp 1s ease-out 0.5s both;
}

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 0.9; transform: translateY(0); }
}

.theme-toggle{ 
  position:absolute; 
  top:20px; 
  right:20px; 
  font-size:2rem; 
  background:rgba(255,255,255,0.1); 
  border:2px solid rgba(255,255,255,0.2);
  color: var(--dark-text);
  border-radius: 50%;
  width: 60px;
  height: 60px;
  cursor:pointer; 
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.theme-toggle:hover {
  background: rgba(255,255,255,0.2);
  transform: rotate(180deg) scale(1.1);
  box-shadow: 0 0 20px var(--glow-color);
}

body.light .theme-toggle {
  color: var(--light-text);
  background: rgba(0,0,0,0.1);
  border-color: rgba(0,0,0,0.2);
}

/* ENHANCED NAVIGATION */
nav{ 
  display:flex; 
  justify-content:center; 
  padding:0; 
  background: rgba(0,0,0,0.3);
  backdrop-filter: blur(15px);
  border-top: 1px solid rgba(255,255,255,0.1);
  border-bottom: 1px solid rgba(255,255,255,0.1);
  position: sticky;
  top: 0;
  z-index: 100;
  animation: slideInDown 0.8s ease-out;
}

@keyframes slideInDown {
  from { transform: translateY(-100%); }
  to { transform: translateY(0); }
}

nav a{ 
  color:var(--accent-dark); 
  margin:0; 
  padding: 20px 30px;
  text-decoration:none; 
  font-weight: 600;
  position: relative;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-size: 0.95rem;
}

nav a::before {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--glow-color), var(--secondary-glow));
  transition: all 0.3s ease;
  transform: translateX(-50%);
}

nav a:hover {
  color: #fff;
  background: rgba(255,255,255,0.05);
  text-shadow: 0 0 10px var(--glow-color);
}

nav a:hover::before {
  width: 80%;
}

body.light nav { 
  background: rgba(255,255,255,0.4); 
}
body.light nav a{ 
  color:var(--accent-light); 
}

/* ENHANCED SECTIONS */
section{ 
  max-width:1200px; 
  margin: 80px auto; 
  padding:60px 30px; 
  text-align:center; 
  background: var(--card-dark);
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  backdrop-filter: blur(15px);
  border: 1px solid rgba(255,255,255,0.1);
  position: relative;
  overflow: hidden;
  animation: fadeInScale 0.8s ease-out;
  z-index: 2;
}

@keyframes fadeInScale {
  from { opacity: 0; transform: scale(0.9) translateY(30px); }
  to { opacity: 1; transform: scale(1) translateY(0); }
}

section::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(0,212,255,0.03) 0%, transparent 70%);
  animation: rotate 20s linear infinite;
  z-index: -1;
}

@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

body.light section {
  background: var(--card-light);
  box-shadow: 0 20px 60px rgba(0,0,0,0.1);
  border-color: rgba(0,0,0,0.1);
}

body.light section::before {
  background: radial-gradient(circle, rgba(231,76,60,0.05) 0%, transparent 70%);
}

h2{ 
  margin-bottom:30px; 
  font-family: 'Orbitron', monospace;
  font-size: clamp(1.8rem, 4vw, 2.5rem);
  font-weight: 700;
  color: var(--glow-color);
  text-transform: uppercase;
  letter-spacing: 2px;
  position: relative;
  padding-bottom: 20px;
}

h2::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 100px;
  height: 3px;
  background: linear-gradient(90deg, var(--glow-color), var(--secondary-glow));
  transform: translateX(-50%);
  border-radius: 2px;
}

body.light h2 {
  color: var(--accent-light);
}

/* ENHANCED VIDEO PLAYER */
.video-wrapper{
  position: relative;
  width: 100%;
  max-width: 900px;
  margin: 40px auto;
  background: #000;
  border-radius: 20px;
  overflow: hidden;
  aspect-ratio: 16/9;
  box-shadow: 0 25px 80px rgba(0,0,0,0.4);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.video-wrapper:hover {
  transform: scale(1.02);
  box-shadow: 0 30px 100px rgba(0,212,255,0.2);
}

video{
  width:100%;
  height:100%;
  display:block;
  object-fit:contain;
  background:#000;
}

.video-controls{
  position:absolute;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:15px 20px;
  color:#fff;
  font-size:14px;
  background: linear-gradient(to top, rgba(0,0,0,0.8), rgba(0,0,0,0.4) 50%, transparent);
  transition:opacity 0.3s ease;
  backdrop-filter: blur(5px);
}

.video-controls button{
  background: rgba(255,255,255,0.15);
  border:none;
  color:#fff;
  padding:10px 15px;
  border-radius:8px;
  cursor:pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  font-size: 16px;
}

.video-controls button:hover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.05);
}

.video-controls input[type="range"]{ 
  flex:1; 
  margin:0 15px; 
  height: 6px;
  background: rgba(255,255,255,0.3);
  border-radius: 3px;
  outline: none;
}

/* ENHANCED ACTORS SECTION */
.dependence{ 
  display:grid; 
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap:30px; 
  margin-top:50px; 
}

.actor{ 
  padding:30px; 
  background: rgba(255,255,255,0.05); 
  border-radius:20px; 
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
  cursor:pointer; 
  position: relative;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
}

.actor::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
  transition: left 0.5s ease;
}

.actor:hover::before {
  left: 100%;
}

.actor:hover{ 
  transform:translateY(-10px) scale(1.02); 
  background: rgba(255,255,255,0.1); 
  box-shadow: 0 25px 80px rgba(0,212,255,0.3);
  border-color: var(--glow-color);
}

body.light .actor{ 
  background: rgba(255,255,255,0.7); 
  border-color: rgba(0,0,0,0.1);
}

body.light .actor:hover {
  background: rgba(255,255,255,0.9);
  box-shadow: 0 25px 80px rgba(231,76,60,0.2);
  border-color: var(--accent-light);
}

.actor h3{ 
  margin-bottom:15px; 
  font-family: 'Orbitron', monospace;
  color: var(--glow-color);
  font-size: 1.3rem;
  font-weight: 600;
}

body.light .actor h3 {
  color: var(--accent-light);
}

.actor p {
  font-size: 1rem;
  line-height: 1.6;
  opacity: 0.9;
}

/* ENHANCED COMIC OVERLAY */
.comic-overlay{
  display:none;
  position:fixed; 
  top:0; 
  left:0;
  width:100%; 
  height:100%;
  background: rgba(0,0,0,0.95);
  z-index:9999;
  justify-content:center; 
  align-items:center; 
  flex-direction:column;
  backdrop-filter: blur(20px);
  animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.comic-container{
  position:relative;
  width:90vw;
  height:90vh;
  max-width:100%;
  max-height:100%;
  overflow:hidden;
  border-radius:20px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow: 0 50px 150px rgba(0,0,0,0.8);
  border: 2px solid rgba(255,255,255,0.2);
  animation: slideInScale 0.4s ease-out;
}

@keyframes slideInScale {
  from { 
    opacity: 0; 
    transform: scale(0.8) translateY(50px); 
  }
  to { 
    opacity: 1; 
    transform: scale(1) translateY(0); 
  }
}

.comic-slides{
  display:flex;
  transition:transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
  will-change:transform;
  width:100%;
  height:100%;
}

.comic-slide{
  min-width:100%;
  min-height:100%;
  box-sizing:border-box;
  display:flex;
  align-items:center;
  justify-content:center;
}

.comic-slide img{
  width:100%;
  height:100%;
  object-fit:contain;
  border-radius:15px;
  transition: transform 0.3s ease;
}

.comic-counter{ 
  position:absolute; 
  top:20px; 
  right:25px; 
  color:#fff; 
  background: rgba(0,0,0,0.6); 
  padding:10px 20px; 
  border-radius:25px; 
  font-size:16px; 
  z-index:20;
  font-weight: 600;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
}

.close-comic{ 
  position:absolute; 
  top:20px; 
  left:25px; 
  background: rgba(255,255,255,0.15); 
  color:#fff; 
  border:none; 
  padding:12px 16px; 
  border-radius:50%; 
  cursor:pointer; 
  z-index:20;
  font-size: 18px;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.close-comic:hover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.1);
}

.comic-nav{ 
  margin-top:25px; 
  display:flex; 
  justify-content:space-between; 
  width:180px;
  gap: 20px;
}

.comic-nav button{ 
  background: rgba(255,255,255,0.15); 
  border:none; 
  color:#fff; 
  padding:12px 20px; 
  border-radius:25px; 
  cursor:pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.2);
  flex: 1;
}

.comic-nav button:hover {
  background: rgba(255,255,255,0.25);
  transform: translateY(-2px);
}

/* ENHANCED GAME CONTAINER */
#game-container {
  width: 100%;
  max-width: 900px;
  aspect-ratio: 3/2;
  border: 3px solid var(--glow-color);
  border-radius: 20px;
  overflow: hidden;
  margin: 50px auto;
  position: relative;
  box-shadow: 
    0 0 50px rgba(0,212,255,0.4),
    inset 0 0 50px rgba(0,212,255,0.1);
  transition: all 0.3s ease;
}

#game-container:hover {
  box-shadow: 
    0 0 80px rgba(0,212,255,0.6),
    inset 0 0 80px rgba(0,212,255,0.15);
}

canvas {
  width: 100% !important;
  height: 100% !important;
  display: block;
  border-radius: 17px;
}

/* INTRO SECTION ENHANCEMENTS */
#intro p {
  font-size: 1.1rem;
  line-height: 1.8;
  margin-bottom: 25px;
  opacity: 0.9;
}

#intro p:first-of-type {
  font-size: 1.2rem;
  font-weight: 400;
  color: var(--glow-color);
  margin-bottom: 35px;
}

body.light #intro p:first-of-type {
  color: var(--accent-light);
}

/* RESPONSIVE DESIGN */
@media (max-width: 768px) {
  header {
    padding: 40px 15px;
  }
  
  header h1 {
    font-size: 2.5rem;
  }
  
  nav a {
    padding: 15px 20px;
    font-size: 0.9rem;
  }
  
  section {
    margin: 40px 15px;
    padding: 40px 20px;
  }
  
  .dependence {
    grid-template-columns: 1fr;
    gap: 20px;
  }
  
  .theme-toggle {
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
  }
  
  .comic-container {
    width: 95vw;
    height: 85vh;
  }
  
  .comic-nav {
    width: 140px;
  }
}

/* LOADING ANIMATION */
.section-loading {
  opacity: 0;
  animation: sectionFadeIn 0.8s ease-out 0.2s forwards;
}

@keyframes sectionFadeIn {
  from { 
    opacity: 0; 
    transform: translateY(30px); 
  }
  to { 
    opacity: 1; 
    transform: translateY(0); 
  }
}
</style>
</head>

<body>
<!-- Floating Particles -->
<div class="particles" id="particles"></div>

<div class="stars"></div>
<div class="clouds"></div>

<header>
  <h1>Interactive Stellar Stories</h1>
  <p>Explore the magnificent cosmos and understand space weather phenomena through immersive storytelling</p>
  <button class="theme-toggle" id="themeToggle">🌙</button>
</header>

<nav>
  <a href="#intro">Overview</a>
  <a href="#story">Interactive Story</a>
  <a href="#dependence">Impact Analysis</a>
  <a href="#game">Space Game</a>
</nav>

<section id="intro" class="section-loading">
  <h2>Welcome to the World of Space Weather</h2>
  <p>Discover the invisible forces that shape our cosmic environment and directly impact life on Earth through dynamic solar phenomena.</p>
  
  <p>Solar weather encompasses the complex conditions in space driven by our Sun's magnetic activity. This includes solar flares, sunspots, coronal mass ejections, and the continuous solar wind. These powerful events release tremendous amounts of energy and charged particles into the solar system, creating a dynamic and ever-changing space environment.</p>
  
  <p><strong>SOLAR FLARE:</strong> A solar flare represents one of the most spectacular displays of our Sun's power - a sudden, intense burst of electromagnetic radiation from the solar surface. These events can release energy equivalent to billions of nuclear bombs, sending waves of radiation across the solar system that can dramatically affect satellite operations, radio communications, and even power grids here on Earth.</p>
</section>

<section id="story" class="section-loading">
  <h2>Interactive Story Experience</h2>
  <p>Immerse yourself in our visual narrative exploring the journey of solar flares from the Sun to Earth.</p>

  <div class="video-wrapper">
    <video id="spaceVideo" preload="metadata" playsinline>
      <source src="animation1.mp4" type="video/mp4">
      Your browser does not support HTML5 video.
    </video>

    <div class="video-controls" id="videoControls">
      <button id="playPause">▶</button>
      <input id="seekBar" type="range" min="0" max="100" step="0.1" value="0">
      <span id="timeDisplay">0:00 / 0:00</span>
    </div>
  </div>
</section>

<section id="dependence" class="section-loading">
  <h2>Space Weather Impact Analysis</h2>
  <p>Explore how solar phenomena affect different aspects of modern society through interactive case studies.</p>
  
  <div class="dependence">
    <div class="actor" id="farmers">
      <h3>🌾 Agricultural Systems</h3>
      <p>Modern precision agriculture relies heavily on GPS technology for automated tractors, drone navigation, and irrigation timing. Solar storms can disrupt these satellite signals, causing navigation errors that affect planting patterns, harvesting efficiency, and crop monitoring systems.</p>
    </div>
    
    <div class="actor" id="pilots">
      <h3>✈️ Aviation Industry</h3>
      <p>Commercial aviation faces significant challenges during solar events. High-altitude polar flights experience increased radiation exposure, potentially requiring route changes or altitude adjustments. Communication systems can also be disrupted, affecting air traffic control coordination.</p>
    </div>
    
    <div class="actor" id="astronauts">
      <h3>🚀 Space Exploration</h3>
      <p>Astronauts aboard the International Space Station and future Mars missions face direct exposure to dangerous solar radiation. During major solar storms, crew members must take shelter in specially shielded areas to avoid potentially life-threatening radiation doses.</p>
    </div>
    
    <div class="actor" id="powergrid">
      <h3>⚡ Power Infrastructure</h3>
      <p>Geomagnetic storms induced by solar activity can create electrical currents in power transmission lines, potentially overloading transformers and causing widespread blackouts. The 1989 Quebec blackout affected 6 million people due to such geomagnetic disturbances.</p>
    </div>
    
    <div class="actor" id="generalpublic">
      <h3>📱 Digital Society</h3>
      <p>Our interconnected world depends on satellite communications, GPS navigation, and internet infrastructure. Solar storms can disrupt mobile networks, internet services, banking systems, and emergency communication networks, affecting billions of people globally.</p>
    </div>
  </div>
</section>

<section id="game" class="section-loading">
  <h2>Solar Flare Defense Mission</h2>
  <p>Take control of Earth's magnetic field and protect our planet from incoming solar radiation. Collect beneficial solar energy while deflecting dangerous flares to maintain our technological civilization.</p>
  
  <p><strong>Mission Objective:</strong> Successfully capture 30 light solar flares 🔥 to harness their energy while avoiding 5 intense solar flares ⚡ that could damage our infrastructure. Master the delicate balance between harnessing solar power and protecting Earth's technology.</p>
  
  <div id="game-container"></div>
</section>

<!-- COMIC OVERLAY -->
<div class="comic-overlay" id="comicOverlay" aria-hidden="true">
  <div class="comic-container" role="dialog" aria-modal="true">
    <button class="close-comic" id="closeComicBtn" aria-label="Close">✖</button>
    <div class="comic-counter" id="comicCounter">1 / 4</div>
    <div class="comic-slides" id="comicSlides"></div>
  </div>

  <div class="comic-nav" id="comicNav">
    <button id="prevSlide">⟨ Previous</button>
    <button id="nextSlide">Next ⟩</button>
  </div>
</div>

<script>
/* ENHANCED THEME TOGGLE */
const themeToggle=document.getElementById('themeToggle');
themeToggle.addEventListener('click',()=>{
  document.body.classList.toggle('light'); 
  themeToggle.textContent=document.body.classList.contains('light')?'☀':'🌙';
  
  // Add theme transition effect
  document.body.style.transition = 'all 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
});

/* FLOATING PARTICLES ANIMATION */
function createParticles() {
  const particlesContainer = document.getElementById('particles');
  const particleCount = 15;
  
  for(let i = 0; i < particleCount; i++) {
    const particle = document.createElement('div');
    particle.className = 'particle';
    
    // Random size and position
    const size = Math.random() * 4 + 2;
    particle.style.width = size + 'px';
    particle.style.height = size + 'px';
    particle.style.left = Math.random() * 100 + '%';
    
    // Random animation delay and duration
    particle.style.animationDelay = Math.random() * 15 + 's';
    particle.style.animationDuration = (Math.random() * 20 + 15) + 's';
    
    particlesContainer.appendChild(particle);
  }
}

// Initialize particles
createParticles();

/* SECTION LOADING ANIMATIONS */
const observerOptions = {
  threshold: 0.1,
  rootMargin: '0px 0px -50px 0px'
};

const sectionObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if(entry.isIntersecting) {
      entry.target.style.animationDelay = '0s';
      entry.target.classList.add('section-visible');
    }
  });
}, observerOptions);

document.querySelectorAll('.section-loading').forEach(section => {
  sectionObserver.observe(section);
});

/* VIDEO PLAYER */
const video = document.getElementById("spaceVideo");
const playPause = document.getElementById("playPause");
const seekBar = document.getElementById("seekBar");
const timeDisplay = document.getElementById("timeDisplay");

function formatTime(seconds){ 
  if (!isFinite(seconds)) return '0:00'; 
  const m=Math.floor(seconds/60); 
  const s=Math.floor(seconds%60); 
  return `${m}:${s<10?'0'+s:s}`; 
}

playPause.addEventListener('click', ()=>{
  if(video.paused||video.ended){
    video.play(); 
    playPause.textContent='⏸';
    playPause.style.transform = 'scale(1.1)';
    setTimeout(() => playPause.style.transform = 'scale(1)', 150);
  } else{
    video.pause(); 
    playPause.textContent='▶';
    playPause.style.transform = 'scale(1.1)';
    setTimeout(() => playPause.style.transform = 'scale(1)', 150);
  }
});

video.addEventListener('loadedmetadata', ()=>{
  timeDisplay.textContent=`${formatTime(0)} / ${formatTime(video.duration)}`;
});

video.addEventListener('timeupdate', ()=>{
  if(video.duration){
    const pct=(video.currentTime/video.duration)*100;
    seekBar.value=pct;
    timeDisplay.textContent=`${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
  }
});

seekBar.addEventListener('input', ()=>{
  if(video.duration){
    video.currentTime=(seekBar.value/100)*video.duration;
  }
});

/* ENHANCED COMIC VIEWER */
const comics = {
  farmers: ['farmer1.jpg','farmer2.jpg','farmer3.jpg','farmer4.jpg'],
  pilots: ['pilot1.jpg','pilot2.jpg','pilot3.jpg','pilot4.jpg'],
  astronauts: ['astronaut1.jpg','astronaut2.jpg','astronaut3.jpg','astronaut4.jpg'],
  powergrid: ['grid1.jpg','grid2.jpg','grid3.jpg','grid4.jpg'],
  generalpublic: ['public1.jpg','public2.jpg','public3.jpg','public4.jpg']
};

const overlay=document.getElementById('comicOverlay');
const slidesContainer=document.getElementById('comicSlides');
const counterEl=document.getElementById('comicCounter');
const prevBtn=document.getElementById('prevSlide');
const nextBtn=document.getElementById('nextSlide');
const closeBtn=document.getElementById('closeComicBtn');

let currentSlides=[],currentIndex=0;

function populateSlides(images){
  slidesContainer.innerHTML='';
  images.forEach(src=>{
    const slide=document.createElement('div');
    slide.className='comic-slide';
    const img=document.createElement('img');
    img.src=src;
    img.alt='Comic page';
    img.style.opacity = '0';
    img.onload = () => {
      img.style.transition = 'opacity 0.3s ease';
      img.style.opacity = '1';
    };
    slide.appendChild(img);
    slidesContainer.appendChild(slide);
  });
  slidesContainer.style.transform='translateX(0%)';
}

function openComic(actorKey){
  if(!comics[actorKey]) return;
  currentSlides=comics[actorKey].slice();
  currentIndex=0;
  populateSlides(currentSlides);
  counterEl.textContent=`${currentIndex+1} / ${currentSlides.length}`;
  overlay.style.display='flex';
  overlay.setAttribute('aria-hidden','false');
  slidesContainer.style.transform='translateX(0%)';
  
  // Add opening animation
  setTimeout(() => {
    overlay.style.opacity = '1';
  }, 10);
}

function closeComic(){
  overlay.style.opacity = '0';
  setTimeout(() => {
    overlay.style.display='none';
    overlay.setAttribute('aria-hidden','true');
    slidesContainer.innerHTML='';
    currentSlides=[];
    currentIndex=0;
  }, 300);
}

function showIndex(i){
  if(currentSlides.length===0) return;
  if(i<0)i=currentSlides.length-1;
  if(i>=currentSlides.length)i=0;
  currentIndex=i;
  slidesContainer.style.transform=`translateX(${-currentIndex*100}%)`;
  counterEl.textContent=`${currentIndex+1} / ${currentSlides.length}`;
  
  // Add slide transition effect
  slidesContainer.style.transition='transform 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
}

prevBtn.addEventListener('click', ()=>{
  showIndex(currentIndex-1);
  prevBtn.style.transform = 'scale(0.95)';
  setTimeout(() => prevBtn.style.transform = 'scale(1)', 150);
});

nextBtn.addEventListener('click', ()=>{
  showIndex(currentIndex+1);
  nextBtn.style.transform = 'scale(0.95)';
  setTimeout(() => nextBtn.style.transform = 'scale(1)', 150);
});

closeBtn.addEventListener('click', closeComic);

// Enhanced actor click handlers with animation
['farmers','pilots','astronauts','powergrid','generalpublic'].forEach(id=>{
  const element = document.getElementById(id);
  element.addEventListener('click', ()=>{
    element.style.transform = 'scale(0.98)';
    setTimeout(() => {
      element.style.transform = 'translateY(-10px) scale(1.02)';
      openComic(id);
    }, 100);
  });
  
  // Add hover sound effect simulation
  element.addEventListener('mouseenter', () => {
    element.style.transition = 'all 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
  });
});

// Keyboard navigation for comics
document.addEventListener('keydown', (e) => {
  if(overlay.style.display === 'flex') {
    if(e.key === 'ArrowLeft') {
      e.preventDefault();
      showIndex(currentIndex-1);
    } else if(e.key === 'ArrowRight') {
      e.preventDefault();
      showIndex(currentIndex+1);
    } else if(e.key === 'Escape') {
      e.preventDefault();
      closeComic();
    }
  }
});

/* SMOOTH SCROLLING FOR NAVIGATION */
document.querySelectorAll('nav a').forEach(anchor => {
  anchor.addEventListener('click', function (e) {
    e.preventDefault();
    const targetId = this.getAttribute('href').substring(1);
    const targetElement = document.getElementById(targetId);
    
    if(targetElement) {
      // Add click animation
      this.style.transform = 'scale(0.95)';
      setTimeout(() => this.style.transform = 'scale(1)', 150);
      
      targetElement.scrollIntoView({
        behavior: 'smooth',
        block: 'start'
      });
    }
  });
});

/* --- ENHANCED GAME CODE --- */
let basketX, basketWidth, basketHeight;
let flares = [];
let lightScore = 0, intenseScore = 0;
let gameState = "start";
let dragging = false, movingLeft = false, movingRight = false;
let startTime, elapsedTime = 0;
let sunImg, earthImg, auroraImg, gameOverImg;
let lightSound, intenseSound;

// Game visual effects
let particles = [];
let screenShake = 0;
let gameScale = 1;

function preload() {
  // Images with error handling
  try {
    auroraImg = loadImage("aurora.jpg");
    sunImg = loadImage("sun12.png");
    earthImg = loadImage("earth1.png");
    gameOverImg = loadImage("gps.jpg");
  } catch(e) {
    console.log("Some images failed to load, using fallbacks");
  }

  try {
    lightSound = loadSound("coin.mp3");
    intenseSound = loadSound("error.mp3");
  } catch(e) {
    console.log("Audio files not available");
  }
}

function setup() {
  let container = document.getElementById("game-container");
  let w = container.clientWidth;
  let h = container.clientHeight;
  let cnv = createCanvas(w, h);
  cnv.parent("game-container");
  scaleGameElements();
  
  // Initialize particles
  for(let i = 0; i < 50; i++) {
    particles.push({
      x: random(width),
      y: random(height),
      vx: random(-0.5, 0.5),
      vy: random(-0.5, 0.5),
      alpha: random(50, 150),
      size: random(1, 3)
    });
  }
}

function windowResized() {
  let container = document.getElementById("game-container");
  resizeCanvas(container.clientWidth, container.clientHeight);
  scaleGameElements();
}

function scaleGameElements() {
  basketWidth = width * 0.15;
  basketHeight = height * 0.08;
  basketX = width / 2;
}

function draw() {
  // Screen shake effect
  if(screenShake > 0) {
    translate(random(-screenShake, screenShake), random(-screenShake, screenShake));
    screenShake *= 0.9;
  }
  
  // Scale effect
  scale(gameScale);
  gameScale = lerp(gameScale, 1, 0.1);
  
  // Enhanced background
  drawStarField();
  
  if (gameState === "start") return drawStartScreen();
  if (gameState === "giftOverlay") return drawGiftOverlay();
  if (gameState === "aurora") return drawAuroraScreen();
  if (gameState === "gameover") return drawGameOverScreen();
  drawPlayingGame();
}

function drawStarField() {
  // Gradient background
  for(let i = 0; i <= height; i++) {
    let alpha = map(i, 0, height, 0, 1);
    let c = lerpColor(color(15, 15, 40), color(5, 5, 15), alpha);
    stroke(c);
    line(0, i, width, i);
  }
  
  // Animated particles
  particles.forEach(p => {
    p.x += p.vx;
    p.y += p.vy;
    
    if(p.x < 0) p.x = width;
    if(p.x > width) p.x = 0;
    if(p.y < 0) p.y = height;
    if(p.y > height) p.y = 0;
    
    stroke(255, p.alpha);
    strokeWeight(p.size);
    point(p.x, p.y);
  });
}

function drawStartScreen() {
  // Enhanced start screen
  fill(255, 255, 255, 200);
  textAlign(CENTER, CENTER);
  textSize(width * 0.04);
  
  // Pulsing effect
  let pulse = 1 + sin(frameCount * 0.1) * 0.1;
  textSize(width * 0.035 * pulse);
  
  text("🌟 SOLAR FLARE DEFENSE MISSION 🌟", width/2, height/2 - 60);
  
  textSize(width * 0.025);
  fill(255, 255, 255, 180);
  text("Collect light solar flares 🔥, Avoid intense solar flares ⚡", width/2, height/2 - 20);
  text("Use mouse/arrow keys to control Earth's magnetic field", width/2, height/2 + 10);
  
  drawEnhancedButton(width/2 - 120, height/2 + 40, 240, 50, "🚀 START MISSION", color(0, 200, 100));
}

function drawGiftOverlay() {
  fill(255, 255, 100, 200);
  textAlign(CENTER, CENTER);
  textSize(width * 0.04);
  
  let glow = 1 + sin(frameCount * 0.2) * 0.3;
  textSize(width * 0.035 * glow);
  
  text("🎉 MISSION SUCCESSFUL! 🎉", width/2, height/2 - 60);
  
  textSize(width * 0.025);
  fill(255, 255, 255, 200);
  text("You have successfully collected 30 light flares!", width/2, height/2 - 20);
  
  drawEnhancedButton(width/2 - 120, height/2 + 20, 240, 50, "🎁 CLAIM REWARD", color(255, 200, 0));
}

function drawAuroraScreen() {
  if(auroraImg) {
    imageMode(CORNER);
    tint(255, 220);
    image(auroraImg, 0, 0, width, height);
    noTint();
  }
  
  fill(255, 255, 255, 240);
  textAlign(CENTER, CENTER);
  textSize(width * 0.05);
  
  let celebration = 1 + sin(frameCount * 0.15) * 0.2;
  textSize(width * 0.04 * celebration);
  
  text("🌍 EARTH PROTECTED! 🌍", width/2, height/2 - 60);
  
  textSize(width * 0.025);
  fill(255, 255, 255, 200);
  text("The Aurora Borealis dances in celebration!", width/2, height/2 - 20);
  text("You have mastered the art of space weather defense!", width/2, height/2 + 10);
  
  drawEnhancedButton(width/2 - 120, height/2 + 60, 240, 50, "🔄 NEW MISSION", color(100, 150, 255));
}

function drawGameOverScreen() {
  if(gameOverImg) {
    imageMode(CORNER);
    tint(255, 180);
    image(gameOverImg, 0, 0, width, height);
    noTint();
  }
  
  fill(255, 100, 100, 240);
  textAlign(CENTER, CENTER);
  textSize(width * 0.06);
  
  let warning = 1 + sin(frameCount * 0.3) * 0.1;
  textSize(width * 0.05 * warning);
  
  text("⚠️ MISSION FAILED ⚠️", width/2, height/2 - 100);
  
  textSize(width * 0.03);
  fill(255, 255, 255, 220);
  text("Critical infrastructure damage detected!", width/2, height/2 - 50);
  text("GPS and communication systems disrupted", width/2, height/2 - 20);
  
  drawEnhancedButton(width/2 - 120, height/2 + 40, 240, 50, "🔄 RETRY MISSION", color(255, 100, 100));
}

function drawPlayingGame() {
  elapsedTime = floor((millis() - startTime) / 1000);
  let remainingTime = max(30 - elapsedTime, 0);
  if (remainingTime <= 0) {
    gameState = "gameover";
    addScreenShake(15);
  }

  // Enhanced sun with glow effect
  if(sunImg) {
    push();
    translate(width / 2, height * 0.15);
    
    // Sun glow effect
    for(let r = 50; r > 0; r--) {
      fill(255, 200, 0, 2);
      ellipse(0, 0, r * 4, r * 4);
    }
    
    imageMode(CENTER);
    let sunGlow = 1 + sin(frameCount * 0.1) * 0.1;
    image(sunImg, 0, 0, width * 0.25 * sunGlow, height * 0.2 * sunGlow);
    pop();
  }

  // Enhanced UI
  fill(255, 255, 255, 240);
  textAlign(CENTER);
  textSize(width * 0.045);
  
  // Time warning effect
  if(remainingTime <= 10) {
    let urgency = 1 + sin(frameCount * 0.4) * 0.2;
    fill(255, 100, 100, 200 * urgency);
    textSize(width * 0.045 * urgency);
  }
  
  text("⏱️ Time: " + remainingTime + "s", width/2, height * 0.25);

  // Enhanced basket movement
  if (dragging) basketX = mouseX - basketWidth / 2;
  if (movingLeft) basketX -= 6;
  if (movingRight) basketX += 6;
  basketX = constrain(basketX, 0, width - basketWidth);

  // Enhanced Earth with magnetic field effect
  if(earthImg) {
    imageMode(CORNER);
    
    // Magnetic field visualization
    stroke(0, 200, 255, 100);
    strokeWeight(3);
    noFill();
    for(let i = 0; i < 3; i++) {
      let fieldRadius = basketWidth * (1.5 + i * 0.5);
      ellipse(basketX + basketWidth/2, height - basketHeight/2 - 20, fieldRadius, fieldRadius * 0.3);
    }
    
    image(earthImg, basketX, height - basketHeight - 20, basketWidth, basketHeight);
  }

  // Enhanced flare rendering
  textAlign(CENTER, CENTER);
  let flareSize = width * 0.06;
  textSize(flareSize);

  for (let i = flares.length - 1; i >= 0; i--) {
    let flare = flares[i];
    flare.y += flare.good ? 2 : 2.5;
    
    // Flare glow effect
    push();
    translate(flare.x, flare.y);
    
    if(flare.good) {
      // Light flare glow
      for(let r = 20; r > 0; r--) {
        fill(255, 150, 0, 5);
        ellipse(0, 0, r, r);
      }
    } else {
      // Intense flare glow
      for(let r = 25; r > 0; r--) {
        fill(255, 0, 100, 3);
        ellipse(0, 0, r, r);
      }
      
      // Lightning effect
      stroke(255, 255, 255, 150);
      strokeWeight(1);
      for(let j = 0; j < 3; j++) {
        let angle = random(TWO_PI);
        let len = random(10, 20);
        line(0, 0, cos(angle) * len, sin(angle) * len);
      }
    }
    
    fill(255);
    noStroke();
    textSize(flareSize * (1 + sin(frameCount * 0.2) * 0.1));
    text(flare.good ? "🔥" : "⚡", 0, 0);
    pop();

    // Enhanced collision detection with effects
    if (flare.y + flareSize/2 >= height - basketHeight - 10 &&
        flare.y - flareSize/2 <= height &&
        flare.x >= basketX &&
        flare.x <= basketX + basketWidth) {

        // Impact effects
        if (flare.good) {
            if(lightSound) lightSound.play();
            addScreenShake(3);
            gameScale = 1.05;
            lightScore++;
            addImpactEffect(flare.x, flare.y, color(255, 200, 0));
            if (lightScore >= 30) gameState = "giftOverlay";
        } else {
            if(intenseSound) intenseSound.play();
            addScreenShake(8);
            gameScale = 0.95;
            intenseScore++;
            addImpactEffect(flare.x, flare.y, color(255, 0, 100));
            if (intenseScore >= 5) gameState = "gameover";
        }

        flares.splice(i, 1);
    } else if (flare.y - flareSize/2 > height) {
        flares.splice(i, 1);
    }
  }

  // Enhanced flare spawning with variety
  if (frameCount % (30 - floor(elapsedTime/3)) === 0) {
    let isGood = random() > 0.25;
    let xPos;
    
    if(isGood) {
      // Light flares spawn more centrally
      xPos = random(width/2 - width/3, width/2 + width/3);
    } else {
      // Intense flares can spawn anywhere
      xPos = random(width * 0.1, width * 0.9);
    }
    
    flares.push({ 
      x: xPos, 
      y: height * 0.15, 
      good: isGood,
      trail: []
    });
  }

  // Enhanced score display
  fill(255, 255, 255, 240);
  stroke(0, 0, 0, 100);
  strokeWeight(2);
  textAlign(LEFT); 
  textSize(width * 0.04);
  
  // Light flares score
  fill(255, 200, 0, 240);
  text("🔥 Collected: " + lightScore, 20, 40);
  
  // Progress bar for light flares
  fill(255, 200, 0, 100);
  rect(20, 50, 200, 8, 4);
  fill(255, 200, 0, 240);
  rect(20, 50, map(lightScore, 0, 30, 0, 200), 8, 4);
  
  // Intense flares score
  textAlign(RIGHT);
  fill(255, 100, 100, 240);
  text("⚡ Impacts: " + intenseScore + "/5", width - 20, 40);
  
  // Danger bar for intense flares
  fill(255, 100, 100, 100);
  rect(width - 220, 50, 200, 8, 4);
  fill(255, 100, 100, 240);
  rect(width - 220, 50, map(intenseScore, 0, 5, 0, 200), 8, 4);
}

function drawEnhancedButton(x, y, w, h, label, buttonColor) {
  // Button glow
  for(let r = 20; r > 0; r--) {
    fill(red(buttonColor), green(buttonColor), blue(buttonColor), 3);
    rect(x - r/2, y - r/2, w + r, h + r, 15);
  }
  
  // Button body
  fill(buttonColor);
  rect(x, y, w, h, 12);
  
  // Button highlight
  fill(255, 255, 255, 50);
  rect(x, y, w, h/3, 12);
  
  // Button text
  fill(255);
  textAlign(CENTER, CENTER);
  textSize(width * 0.032);
  text(label, x + w/2, y + h/2);
}

function addScreenShake(intensity) {
  screenShake = intensity;
}

function addImpactEffect(x, y, effectColor) {
  // Add particle explosion effect here
  for(let i = 0; i < 5; i++) {
    particles.push({
      x: x + random(-10, 10),
      y: y + random(-10, 10),
      vx: random(-2, 2),
      vy: random(-2, 2),
      alpha: 255,
      size: random(2, 4),
      life: 30,
      color: effectColor
    });
  }
}

function mousePressed() {
  // Enhanced button interactions
  if (gameState === "start" &&
      mouseX > width/2 - 120 && mouseX < width/2 + 120 &&
      mouseY > height/2 + 40 && mouseY < height/2 + 90) {
    gameState = "playing";
    startTime = millis();
    addScreenShake(5);
  } else if (gameState === "giftOverlay" &&
             mouseX > width/2 - 120 && mouseX < width/2 + 120 &&
             mouseY > height/2 + 20 && mouseY < height/2 + 70) {
    gameState = "aurora";
    addScreenShake(3);
  } else if (gameState === "aurora" &&
             mouseX > width/2 - 120 && mouseX < width/2 + 120 &&
             mouseY > height/2 + 60 && mouseY < height/2 + 110) {
    restartGame();
  } else if (gameState === "gameover" &&
             mouseX > width/2 - 120 && mouseX < width/2 + 120 &&
             mouseY > height/2 + 40 && mouseY < height/2 + 90) {
    restartGame();
  } else if (gameState === "playing" &&
             mouseX > basketX && mouseX < basketX + basketWidth &&
             mouseY > height - basketHeight - 20 && mouseY < height - 20) {
    dragging = true;
  }
}

function mouseReleased() { 
  dragging = false; 
}

function keyPressed() { 
  if(keyCode===LEFT_ARROW) movingLeft=true; 
  if(keyCode===RIGHT_ARROW) movingRight=true; 
}

function keyReleased() { 
  if(keyCode===LEFT_ARROW) movingLeft=false; 
  if(keyCode===RIGHT_ARROW) movingRight=false; 
}

function restartGame() {
  gameState = "start";
  basketX = width/2;
  flares = [];
  lightScore = 0;
  intenseScore = 0;
  elapsedTime = 0;
  screenShake = 0;
  gameScale = 1;
  addScreenShake(2);
}
